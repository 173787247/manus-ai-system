# å·²æ‰§è¡ŒåŠŸèƒ½æ¸…å•

## ğŸ“‹ æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½æ€»è§ˆ

### âœ… 1. åŸºç¡€æ™ºèƒ½ä½“åŠŸèƒ½ (BaseAgent)

#### å·²æµ‹è¯•çš„åŠŸèƒ½ï¼š
- âœ… **æ™ºèƒ½ä½“åˆå§‹åŒ–**
  - åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹
  - è®¾ç½®åç§°å’Œé…ç½®
  - åˆå§‹åŒ–çŠ¶æ€ä¸º "idle"
  - åˆå§‹åŒ–è®°å¿†å’Œç»Ÿè®¡ä¿¡æ¯

- âœ… **æ•°æ®å¤„ç†**
  - å¤„ç†è¾“å…¥æ•°æ®
  - è¿”å›å¤„ç†ç»“æœ
  - æ•°æ®æ ¼å¼éªŒè¯

- âœ… **çŠ¶æ€ç®¡ç†**
  - çŠ¶æ€è®¾ç½®ï¼ˆidle/working/errorï¼‰
  - çŠ¶æ€é‡ç½®
  - çŠ¶æ€æŸ¥è¯¢

- âœ… **è®°å¿†ç®¡ç†**
  - æ·»åŠ è®°å¿†é¡¹
  - è®°å¿†é•¿åº¦é™åˆ¶
  - è®°å¿†æ—¶é—´æˆ³

- âœ… **ç»Ÿè®¡ä¿¡æ¯**
  - ä»»åŠ¡å®Œæˆæ•°ç»Ÿè®¡
  - ä»»åŠ¡å¤±è´¥æ•°ç»Ÿè®¡
  - å¹³å‡æ‰§è¡Œæ—¶é—´è®¡ç®—
  - æ€»æ‰§è¡Œæ—¶é—´ç´¯è®¡

**æµ‹è¯•æ–‡ä»¶**: `tests/test_base_agent.py`  
**æµ‹è¯•ç”¨ä¾‹**: 5ä¸ª

---

### âœ… 2. æ™ºèƒ½ä½“ç®¡ç†å™¨åŠŸèƒ½ (AgentManager)

#### å·²æµ‹è¯•çš„åŠŸèƒ½ï¼š
- âœ… **æ¶ˆæ¯æ€»çº¿**
  - æ¶ˆæ¯å‘å¸ƒ
  - æ¶ˆæ¯è®¢é˜…
  - æ¶ˆæ¯è·¯ç”±
  - æ¶ˆæ¯å†å²è®°å½•

- âœ… **æ™ºèƒ½ä½“ç®¡ç†**
  - æ™ºèƒ½ä½“åˆå§‹åŒ–
  - æ™ºèƒ½ä½“æ³¨å†Œ
  - æ™ºèƒ½ä½“è·å–
  - æ™ºèƒ½ä½“çŠ¶æ€æŸ¥è¯¢

- âœ… **ä»»åŠ¡åè°ƒ**
  - ä»»åŠ¡åˆ†é…
  - æ™ºèƒ½ä½“åä½œ
  - çŠ¶æ€åŒæ­¥

**æµ‹è¯•æ–‡ä»¶**: `tests/test_agent_manager.py`  
**æµ‹è¯•ç”¨ä¾‹**: 5ä¸ª

---

### âœ… 3. è§„åˆ’æ™ºèƒ½ä½“åŠŸèƒ½ (PlanningAgent)

#### å·²æµ‹è¯•çš„åŠŸèƒ½ï¼š
- âœ… **ä»»åŠ¡ç†è§£**
  - è‡ªç„¶è¯­è¨€ä»»åŠ¡è§£æ
  - ä»»åŠ¡ç›®æ ‡æå–
  - å…³é”®è¯æå–
  - ä»»åŠ¡ç±»å‹åˆ¤æ–­

- âœ… **ä»»åŠ¡åˆ†è§£**
  - å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå­ä»»åŠ¡
  - å­ä»»åŠ¡IDç”Ÿæˆ
  - å­ä»»åŠ¡æè¿°æå–
  - å­ä»»åŠ¡ç±»å‹è¯†åˆ«

- âœ… **ä¾èµ–åˆ†æ**
  - å­ä»»åŠ¡ä¾èµ–å…³ç³»åˆ†æ
  - æ‰§è¡Œé¡ºåºè§„åˆ’
  - æ‹“æ‰‘æ’åº

- âœ… **æ‰§è¡Œè§„åˆ’**
  - æ‰§è¡Œè®¡åˆ’ç”Ÿæˆ
  - æ‰§è¡Œé¡ºåºç¡®å®š
  - æ—¶é—´ä¼°ç®—

**æµ‹è¯•æ–‡ä»¶**: `tests/test_planning_agent.py`  
**æµ‹è¯•ç”¨ä¾‹**: 4ä¸ª

**å®é™…åŠŸèƒ½ç¤ºä¾‹**:
```python
# è¾“å…¥: "æ‰“å¼€æµè§ˆå™¨ï¼Œæœç´¢AI Agent"
# è¾“å‡º: 
# {
#   "subtasks": [
#     {"id": "task_1", "description": "æ‰“å¼€æµè§ˆå™¨", "type": "gui_action"},
#     {"id": "task_2", "description": "æœç´¢AI Agent", "type": "gui_action"}
#   ],
#   "execution_order": ["task_1", "task_2"]
# }
```

---

### âœ… 4. çŸ¥è¯†æ£€ç´¢æ™ºèƒ½ä½“åŠŸèƒ½ (KnowledgeAgent)

#### å·²æµ‹è¯•çš„åŠŸèƒ½ï¼š
- âœ… **å‘é‡æ£€ç´¢**
  - æŸ¥è¯¢å‘é‡ç”Ÿæˆ
  - å‘é‡ç›¸ä¼¼åº¦æœç´¢
  - ç»“æœæ’åº

- âœ… **å…³é”®è¯æ£€ç´¢**
  - æ–‡æ¡£å…³é”®è¯åŒ¹é…
  - ç²¾ç¡®åŒ¹é…æœç´¢
  - ç»“æœè¿‡æ»¤

- âœ… **çŸ¥è¯†å›¾è°±æŸ¥è¯¢**
  - å®ä½“è¯†åˆ«
  - å…³ç³»æŸ¥è¯¢
  - è·¯å¾„æ¨ç†

- âœ… **ç»“æœèåˆ**
  - å¤šæºç»“æœåˆå¹¶
  - ç»“æœå»é‡
  - ç›¸å…³æ€§æ’åº

**æµ‹è¯•æ–‡ä»¶**: `tests/test_knowledge_agent.py`  
**æµ‹è¯•ç”¨ä¾‹**: 4ä¸ª

**å®é™…åŠŸèƒ½ç¤ºä¾‹**:
```python
# è¾“å…¥: "AI Agentç›¸å…³çŸ¥è¯†"
# è¾“å‡º:
# {
#   "status": "success",
#   "results": [
#     {"content": "...", "source": "vector_store", "score": 0.9},
#     {"content": "...", "source": "document_store", "score": 0.8}
#   ]
# }
```

---

### âœ… 5. GUIæ“ä½œæ™ºèƒ½ä½“åŠŸèƒ½ (GUIAgent)

#### å·²æµ‹è¯•çš„åŠŸèƒ½ï¼š
- âœ… **åŠ¨ä½œè§£æ**
  - ä»æ¨¡å‹è¾“å‡ºæå–ä»£ç å—
  - æå–PyAutoGUIå‘½ä»¤
  - æå–æ§åˆ¶ç¬¦ï¼ˆDONE/FAIL/WAITï¼‰

- âœ… **åŠ¨ä½œéªŒè¯**
  - ç™½åå•éªŒè¯
  - å®‰å…¨æ£€æŸ¥
  - åæ ‡éªŒè¯

- âœ… **åŠ¨ä½œæ‰§è¡Œ**
  - é¼ æ ‡æ“ä½œï¼ˆmoveTo, clickï¼‰
  - é”®ç›˜æ“ä½œï¼ˆtypewrite, pressï¼‰
  - æ§åˆ¶ç¬¦å¤„ç†

**æµ‹è¯•æ–‡ä»¶**: `tests/test_gui_agent.py`  
**æµ‹è¯•ç”¨ä¾‹**: 4ä¸ª

**å®é™…åŠŸèƒ½ç¤ºä¾‹**:
```python
# è¾“å…¥: "æˆ‘çœ‹åˆ°éœ€è¦ç‚¹å‡»æŒ‰é’®ã€‚pyautogui.moveTo(500, 300)\npyautogui.click()\nDONE"
# è¾“å‡º: ["moveTo(500, 300)", "click()", "DONE"]
```

---

### âœ… 6. ä»»åŠ¡æ‰§è¡Œå™¨åŠŸèƒ½ (TaskExecutor)

#### å·²æµ‹è¯•çš„åŠŸèƒ½ï¼š
- âœ… **ä»»åŠ¡æ‰§è¡Œæµç¨‹**
  - ä»»åŠ¡æ¥æ”¶
  - è§„åˆ’æ™ºèƒ½ä½“è°ƒç”¨
  - å­ä»»åŠ¡æ‰§è¡Œ
  - ç»“æœæ”¶é›†

- âœ… **é”™è¯¯å¤„ç†**
  - æ™ºèƒ½ä½“æœªåˆå§‹åŒ–å¤„ç†
  - æ‰§è¡Œé”™è¯¯æ•è·
  - é”™è¯¯ä¿¡æ¯è¿”å›
  - æ‰§è¡Œæ—¶é—´è®°å½•

- âœ… **ç»“æœè¿”å›**
  - æ‰§è¡ŒçŠ¶æ€è¿”å›
  - æ‰§è¡Œæ—¶é—´è®°å½•
  - ç»“æœç»“æ„éªŒè¯

**æµ‹è¯•æ–‡ä»¶**: `tests/test_task_executor.py`  
**æµ‹è¯•ç”¨ä¾‹**: 2ä¸ª

**å®é™…åŠŸèƒ½ç¤ºä¾‹**:
```python
# è¾“å…¥: {"instruction": "æµ‹è¯•ä»»åŠ¡", "max_steps": 5}
# è¾“å‡º:
# {
#   "status": "completed" | "error",
#   "execution_time": 0.123,
#   "plan": {...},
#   "results": [...]
# }
```

---

### âœ… 7. é›†æˆæµ‹è¯•åŠŸèƒ½

#### å·²æµ‹è¯•çš„åŠŸèƒ½ï¼š
- âœ… **å®Œæ•´ä»»åŠ¡æµç¨‹**
  - ä»»åŠ¡åˆ›å»º
  - ä»»åŠ¡æ‰§è¡Œ
  - ç»“æœéªŒè¯
  - æ—¶é—´è®°å½•

- âœ… **æ™ºèƒ½ä½“åä½œ**
  - å¤šæ™ºèƒ½ä½“åˆå§‹åŒ–
  - æ™ºèƒ½ä½“é—´é€šä¿¡
  - ä»»åŠ¡åè°ƒ
  - çŠ¶æ€åŒæ­¥

**æµ‹è¯•æ–‡ä»¶**: `tests/test_integration.py`  
**æµ‹è¯•ç”¨ä¾‹**: 2ä¸ª

**å®é™…åŠŸèƒ½ç¤ºä¾‹**:
```python
# å®Œæ•´æµç¨‹:
# 1. åˆ›å»ºä»»åŠ¡: "æµ‹è¯•ä»»åŠ¡ï¼šæ‰“å¼€è®°äº‹æœ¬"
# 2. è§„åˆ’æ™ºèƒ½ä½“åˆ†è§£ä»»åŠ¡
# 3. æ‰§è¡Œå­ä»»åŠ¡
# 4. è¿”å›ç»“æœ
```

---

## ğŸ“Š åŠŸèƒ½è¦†ç›–ç»Ÿè®¡

| æ¨¡å— | åŠŸèƒ½æ•° | æµ‹è¯•ç”¨ä¾‹æ•° | è¦†ç›–ç‡ |
|------|--------|-----------|--------|
| åŸºç¡€æ™ºèƒ½ä½“ | 5 | 5 | 100% |
| æ™ºèƒ½ä½“ç®¡ç†å™¨ | 5 | 5 | 100% |
| è§„åˆ’æ™ºèƒ½ä½“ | 4 | 4 | 100% |
| çŸ¥è¯†æ£€ç´¢ | 4 | 4 | 100% |
| GUIæ“ä½œ | 4 | 4 | 100% |
| ä»»åŠ¡æ‰§è¡Œå™¨ | 3 | 2 | 67% |
| é›†æˆæµ‹è¯• | 2 | 2 | 100% |
| **æ€»è®¡** | **27** | **26** | **96%** |

---

## ğŸ” å¦‚ä½•æŸ¥çœ‹è¾“å‡º

### 1. æµ‹è¯•è¾“å‡º

#### æ§åˆ¶å°è¾“å‡º
è¿è¡Œæµ‹è¯•æ—¶ï¼Œæ‰€æœ‰è¾“å‡ºç›´æ¥æ˜¾ç¤ºåœ¨æ§åˆ¶å°ï¼š

```bash
python run_tests_fixed.py
```

**è¾“å‡ºä½ç½®**: æ§åˆ¶å°ï¼ˆç»ˆç«¯/PowerShellï¼‰

**è¾“å‡ºå†…å®¹**:
- æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹
- æµ‹è¯•ç»“æœï¼ˆPASSED/FAILEDï¼‰
- æµ‹è¯•ç»Ÿè®¡
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

#### è¯¦ç»†è¾“å‡ºç¤ºä¾‹
```
======================== test session starts ============================
tests/test_base_agent.py::test_base_agent_initialization PASSED
tests/test_base_agent.py::test_base_agent_process PASSED
...
======================== 5 passed in 0.07s =============================
```

### 2. æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶

#### ç”ŸæˆHTMLæŠ¥å‘Š
```bash
python -m pytest tests/ --html=report.html --self-contained-html
```

**è¾“å‡ºä½ç½®**: `report.html`  
**æŸ¥çœ‹æ–¹å¼**: ç”¨æµè§ˆå™¨æ‰“å¼€ `report.html`

#### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```bash
python -m pytest tests/ --cov=src --cov-report=html
```

**è¾“å‡ºä½ç½®**: `htmlcov/index.html`  
**æŸ¥çœ‹æ–¹å¼**: ç”¨æµè§ˆå™¨æ‰“å¼€ `htmlcov/index.html`

### 3. æ—¥å¿—è¾“å‡º

#### æ—¥å¿—ä½ç½®
- **ç›®å½•**: `logs/`ï¼ˆå¦‚æœé…ç½®äº†æ—¥å¿—ï¼‰
- **æ–‡ä»¶**: `logs/manus.log`ï¼ˆå¦‚æœå¯ç”¨ï¼‰

#### æŸ¥çœ‹æ—¥å¿—
```bash
# Windows
type logs\manus.log

# Linux/Mac
cat logs/manus.log
```

### 4. æ•°æ®è¾“å‡º

#### æ•°æ®ç›®å½•
- **çŸ¥è¯†æ•°æ®**: `data/knowledge/`
- **ç»éªŒæ•°æ®**: `data/experiences/`
- **è®°å½•æ•°æ®**: `data/recordings/`

#### æŸ¥çœ‹æ•°æ®
```bash
# æŸ¥çœ‹ç›®å½•å†…å®¹
dir data\knowledge
dir data\experiences
dir data\recordings
```

### 5. æµ‹è¯•ç¼“å­˜

#### pytestç¼“å­˜
- **ä½ç½®**: `.pytest_cache/`
- **å†…å®¹**: æµ‹è¯•ç»“æœç¼“å­˜

#### æŸ¥çœ‹ç¼“å­˜
```bash
dir .pytest_cache
```

---

## ğŸ“ æŸ¥çœ‹è¾“å‡ºçš„æ–¹æ³•

### æ–¹æ³•1: æ§åˆ¶å°è¾“å‡ºï¼ˆå®æ—¶ï¼‰

```bash
# è¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹å®æ—¶è¾“å‡º
python run_tests_fixed.py

# æˆ–ä½¿ç”¨pytestç›´æ¥è¿è¡Œ
python -m pytest tests/ -v -s
```

**ä¼˜ç‚¹**: å®æ—¶æŸ¥çœ‹ï¼Œç«‹å³åé¦ˆ  
**ç¼ºç‚¹**: ä¸ä¿å­˜å†å²è®°å½•

### æ–¹æ³•2: ä¿å­˜åˆ°æ–‡ä»¶

```bash
# ä¿å­˜æµ‹è¯•è¾“å‡ºåˆ°æ–‡ä»¶
python run_tests_fixed.py > test_output.txt 2>&1

# æŸ¥çœ‹ä¿å­˜çš„è¾“å‡º
type test_output.txt
```

**è¾“å‡ºä½ç½®**: `test_output.txt`

### æ–¹æ³•3: HTMLæŠ¥å‘Šï¼ˆæ¨èï¼‰

```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
python -m pytest tests/ --html=test_report.html --self-contained-html

# æ‰“å¼€æŠ¥å‘Š
start test_report.html  # Windows
```

**è¾“å‡ºä½ç½®**: `test_report.html`  
**ä¼˜ç‚¹**: å¯è§†åŒ–ï¼Œæ˜“äºæŸ¥çœ‹

### æ–¹æ³•4: è¦†ç›–ç‡æŠ¥å‘Š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/ --cov=src --cov-report=html

# æ‰“å¼€æŠ¥å‘Š
start htmlcov\index.html  # Windows
```

**è¾“å‡ºä½ç½®**: `htmlcov/index.html`  
**å†…å®¹**: ä»£ç è¦†ç›–ç‡è¯¦æƒ…

---

## ğŸ¯ å®é™…æ‰§è¡Œçš„åŠŸèƒ½ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºç¡€æ™ºèƒ½ä½“åˆå§‹åŒ–

**æ‰§è¡Œçš„åŠŸèƒ½**:
```python
agent = TestAgent("TestAgent", {"max_memory": 10})
# åˆ›å»ºæ™ºèƒ½ä½“ï¼Œè®¾ç½®åç§°ã€é…ç½®ã€çŠ¶æ€
```

**è¾“å‡ºä½ç½®**: æ§åˆ¶å°  
**è¾“å‡ºå†…å®¹**: `PASSED` æˆ–æµ‹è¯•ç»“æœ

### ç¤ºä¾‹2: ä»»åŠ¡åˆ†è§£

**æ‰§è¡Œçš„åŠŸèƒ½**:
```python
task = {"instruction": "æ‰“å¼€æµè§ˆå™¨ï¼Œæœç´¢AI Agent"}
plan = planning_agent.decompose_task(task)
# å°†ä»»åŠ¡åˆ†è§£ä¸ºå­ä»»åŠ¡
```

**è¾“å‡ºä½ç½®**: æ§åˆ¶å°  
**è¾“å‡ºå†…å®¹**: åˆ†è§£åçš„ä»»åŠ¡è®¡åˆ’

### ç¤ºä¾‹3: çŸ¥è¯†æ£€ç´¢

**æ‰§è¡Œçš„åŠŸèƒ½**:
```python
result = knowledge_agent.retrieve("AI Agent", top_k=5)
# æ£€ç´¢ç›¸å…³çŸ¥è¯†
```

**è¾“å‡ºä½ç½®**: æ§åˆ¶å°  
**è¾“å‡ºå†…å®¹**: æ£€ç´¢ç»“æœåˆ—è¡¨

### ç¤ºä¾‹4: å®Œæ•´ä»»åŠ¡æ‰§è¡Œ

**æ‰§è¡Œçš„åŠŸèƒ½**:
```python
task = {"instruction": "æµ‹è¯•ä»»åŠ¡ï¼šæ‰“å¼€è®°äº‹æœ¬", "max_steps": 3}
result = executor.execute(task)
# æ‰§è¡Œå®Œæ•´ä»»åŠ¡æµç¨‹
```

**è¾“å‡ºä½ç½®**: æ§åˆ¶å°  
**è¾“å‡ºå†…å®¹**: æ‰§è¡Œç»“æœã€çŠ¶æ€ã€æ—¶é—´

---

## ğŸ“‚ è¾“å‡ºæ–‡ä»¶ä½ç½®æ€»ç»“

| è¾“å‡ºç±»å‹ | ä½ç½® | æŸ¥çœ‹æ–¹å¼ |
|---------|------|---------|
| æµ‹è¯•æ§åˆ¶å°è¾“å‡º | æ§åˆ¶å° | ç›´æ¥æŸ¥çœ‹ |
| æµ‹è¯•HTMLæŠ¥å‘Š | `report.html` | æµè§ˆå™¨æ‰“å¼€ |
| è¦†ç›–ç‡æŠ¥å‘Š | `htmlcov/index.html` | æµè§ˆå™¨æ‰“å¼€ |
| æ—¥å¿—æ–‡ä»¶ | `logs/manus.log` | æ–‡æœ¬ç¼–è¾‘å™¨ |
| æµ‹è¯•è¾“å‡ºæ–‡ä»¶ | `test_output.txt` | æ–‡æœ¬ç¼–è¾‘å™¨ |
| æ•°æ®æ–‡ä»¶ | `data/` | æ–‡ä»¶ç®¡ç†å™¨ |
| æµ‹è¯•ç¼“å­˜ | `.pytest_cache/` | æ–‡ä»¶ç®¡ç†å™¨ |

---

## ğŸš€ å¿«é€ŸæŸ¥çœ‹è¾“å‡º

### æœ€ç®€å•çš„æ–¹æ³•

```bash
# 1. è¿è¡Œæµ‹è¯•ï¼ˆæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼‰
python run_tests_fixed.py

# 2. ç”ŸæˆHTMLæŠ¥å‘Šï¼ˆæŸ¥çœ‹è¯¦ç»†ç»“æœï¼‰
python -m pytest tests/ --html=report.html --self-contained-html
start report.html

# 3. ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼ˆæŸ¥çœ‹ä»£ç è¦†ç›–ï¼‰
python -m pytest tests/ --cov=src --cov-report=html
start htmlcov\index.html
```

---

## ğŸ“‹ åŠŸèƒ½éªŒè¯æ¸…å•

è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯æ¯ä¸ªåŠŸèƒ½ï¼š

```bash
# 1. åŸºç¡€æ™ºèƒ½ä½“åŠŸèƒ½
python -m pytest tests/test_base_agent.py -v

# 2. æ™ºèƒ½ä½“ç®¡ç†å™¨åŠŸèƒ½
python -m pytest tests/test_agent_manager.py -v

# 3. è§„åˆ’æ™ºèƒ½ä½“åŠŸèƒ½
python -m pytest tests/test_planning_agent.py -v

# 4. çŸ¥è¯†æ£€ç´¢åŠŸèƒ½
python -m pytest tests/test_knowledge_agent.py -v

# 5. GUIæ“ä½œåŠŸèƒ½
python -m pytest tests/test_gui_agent.py -v

# 6. ä»»åŠ¡æ‰§è¡ŒåŠŸèƒ½
python -m pytest tests/test_task_executor.py -v

# 7. é›†æˆæµ‹è¯•åŠŸèƒ½
python -m pytest tests/test_integration.py -v -m integration
```

æ¯ä¸ªå‘½ä»¤éƒ½ä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„æ‰§è¡Œç»“æœå’Œè¾“å‡ºã€‚

